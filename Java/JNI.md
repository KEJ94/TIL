# JNI (Java Native Interface)  
JNI 는 C, C++ 로 만들어진 고유기능 즉, 함수를 Java 메서드와 연결한다.  
그로인해 Java 메서드를 호출 할 시, C나 C++ 로 작성된 함수가 실행된다.  
<br><br>
## MinGw 다운로드  
https://www.mingw-w64.org/  
C 컴파일을 위해 MinGw 를 설치한다.  
실습 당시(2022-07-27) 최신버전의 exe파일에 문제가있어 zip파일로 다운로드 후 환경변수 지정  
<br><br>
## 실습 순서 (Window)  
실습 목표 : Spring MVC 프로젝트의 util 디렉터리 안에 JNI 클래스를 만들어서 C로 작성된 함수 호출  
- 자바 코드 작성
- 자바 헤더 생성
- C에 자바 헤더 첨부
- dll 생성  
<br><br>
## 1. 자바 코드 작성  
__[VADAJni.java]__
```
package com.jiransnc.vada.util;
public class VADAJni {
    static { 
        /*
        *   Native 동적 라이브러리 (Windows 에서는 .dll 파일, Linux 에서는 .so 파일)를 로딩한다.
        *   즉 hello.so(Linux) 또는 hello.dll(Windows) 를 로딩한다는 의미이다.
        */
        System.load("C:\\Users\\kth\\Documents\\GitHub\\vada\\src\\VADAJni.dll"); 
    }

    private native int conn();

    public static void main(String[] args){
        try{
            VADAJni jni = new VADAJni();
            System.out.println(jni.conn());
        }catch(Exception e){System.out.println(e.getMessage());}
    }
}
```
<br><br>
## 2. 자바 헤더 생성
컴파일은 클래스 파일이 위치한 상위 디렉터리까지 이동 후 명령어 실행  
<br>
__[CMD]__ 컴파일 
```
C:\Users\kth\Documents\GitHub\vada\src\main\java\com\jiransnc\vada\util>javac VADAJni.java
```
__[CMD]__ 컴파일 (인코딩 에러 발생시)
```
C:\Users\kth\Documents\GitHub\vada\src\main\java\com\jiransnc\vada\util>javac -encoding utf-8 VADAJni.java
```
__[CMD]__ 헤더생성은 src 경로에서 명령어를 실행한다.  
```
C:\Users\kth\Documents\GitHub\vada\src>javah -jni -classpath C:\Users\kth\Documents\GitHub\vada\src\main\java com.jiransnc.vada.util.VADAJni
```
__[com_jiransnc_vada_util_VADAJni.h]__ <jni.h> 에서 "jni.h" 로 수정, conn 함수의 매개변수를 삭제했다.
```
/* DO NOT EDIT THIS FILE - it is machine generated */
#include "jni.h"
/* Header for class com_jiransnc_vada_util_VADAJni */

#ifndef _Included_com_jiransnc_vada_util_VADAJni
#define _Included_com_jiransnc_vada_util_VADAJni
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     com_jiransnc_vada_util_VADAJni
 * Method:    conn
 * Signature: ()I
 */
JNIEXPORT jint JNICALL Java_com_jiransnc_vada_util_VADAJni_conn();

#ifdef __cplusplus
}
#endif
#endif
```  
<br><br>
## 3. C에 자바 헤더 첨부  
__[VADAJni.c]__ src 에 C파일 생성
```
#include "com_jiransnc_vada_util_VADAJni.h"
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

JNIEXPORT jint JNICALL Java_com_jiransnc_vada_util_VADAJni_conn(){
    printf("success");
}
```  
<br><br>
## 4. dll 생성 
C:\Users\kth\Documents\GitHub\vada\src> 경로에 아래 파일 2개 추가  
jdk path > include > __jni.h__   
jdk path > include > win32 > __jni_md.h__ 

__[CMD]__ VADAJni.o 파일 생성
```
C:\Users\kth\Documents\GitHub\vada\src>gcc -fpic -c -l"\Program Files\ojdkbuild\java-1.8.0-openjdk-1.8.0.322-1\include" -l"\Program Files\ojdkbuild\java-1.8.0-openjdk-1.8.0.322-1\include\win32" VADAJni.c
```
__[CMD]__ VADAJni.dll 파일 생성 후 VADAJni.java 실행 
```
C:\Users\kth\Documents\GitHub\vada\src>gcc -shared -o VADAJni.dll VADAJni.o
```  
<br><br>
## 특이사항
- VADAJni.h #include <jni.h> 에서 "jni.h" 로 수정
- VADAJni.h 안의 conn 내용 수정 (매개변수 제거)
- include 안에 있는 __jni.h__ 랑 include/win32 안에 있는 __jni_md.h__ 를 src 안에 넣음
- src 하위 경로 외 다른경로에서 헤더파일 생성이 안되었음
- __success7 출력__ (메모리 릭)
<br><br>






# JNI (Java Native Interface)  
JNI 는 C, C++ 로 만들어진 고유기능 즉, 함수를 Java 메서드와 연결한다.  
그로인해 Java 메서드를 호출 할 시, C나 C++ 로 작성된 함수가 실행된다.  
<br><br>
## MinGw 다운로드  
https://www.mingw-w64.org/  
C언어 컴파일을 위해 mingw 를 설치한다.  
실습 당시 최신버전의 exe파일에 문제가있어 zip파일로 다운로드 후 환경변수 지정  
<br><br>
## 실습 순서 (Window)  
- 자바 코드 작성
- 자바 헤더 생성
- C에 자바 헤더 첨부
- dll 생성  
<br><br>
## 1. 자바 코드 작성  
__[VADAJni.java]__
```
public class VADAJni {
    static { 
        /*
        *   Native 동적 라이브러리 (Windows 에서는 .dll 파일, Linux 에서는 .so 파일)를 로딩한다.
        *   즉 libhello.so(Linux) 또는 hello.dll(Windows) 를 로딩한다는 의미이다.
        */
        System.loadLibrary("VADAJni"); 
    }

    private native int conn();

    public static void main(String[] args){
        VADAJni jni = new VADAJni();
        System.out.println(jni.conn());
    }
}
```
<br><br>
## 2. 자바 헤더 생성
Spring 프로젝트내에서 자바파일을 생성후에 작업하려니 잘 안됨.  
src 바로 아래 경로에 java 파일을 추가해서 작업  

__[CMD]__ 컴파일 
```
C:\Users\kth\Documents\GitHub\vada\src>javac VADAJni.java
```
__[CMD]__ 컴파일 (인코딩 에러 발생시)
```
C:\Users\kth\Documents\GitHub\vada\src>javac -encoding utf-8 VADAJni.java
```
__[CMD]__ 헤더 생성  
```
javah -jni -classpath C:\Users\kth\Documents\GitHub\vada\src VADAJni
```
__[VADAJni.h]__ 생성된 내용과 조금 다를 수 있다. 간단한 실습이니 에러나면 아래처럼 일단 수정할 것  
```
/* DO NOT EDIT THIS FILE - it is machine generated */
#include "jni.h"
/* Header for class VADAJni */

#ifndef _Included_VADAJni
#define _Included_VADAJni
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     VADAJni
 * Method:    conn
 * Signature: ()I
 */
JNIEXPORT jint JNICALL Java_VADAJni_conn();

#ifdef __cplusplus
}
#endif
#endif
```  
<br><br>
## 3. C에 자바 헤더 첨부  
__[VADAJni.c]__ 새로운 파일 생성
```
#include "VADAJni.h"
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

JNIEXPORT jint JNICALL Java_VADAJni_conn(){
    printf("success");
}
```  
<br><br>
## 4. dll 생성 
__[CMD]__ VADAJni.o 파일을 생성
```
gcc -fpic -c -l"\Program Files\ojdkbuild\java-1.8.0-openjdk-1.8.0.322-1\include" -l"\Program Files\ojdkbuild\java-1.8.0-openjdk-1.8.0.322-1\include\win32" VADAJni.c
```
__[CMD]__ VADAJni.dll 파일을 생성  
```
gcc -shared -o VADAJni.dll VADAJni.o
```  
<br><br>
## 실습 중 특이사항
- VADAJni.h #include <jni.h> 에서 "jni.h" 로 수정
- VADAJni.h 안의 conn 내용 수정 (매개변수를 제거)
- include 안에 있는 jni.h 랑 include/win32 안에 있는 jni_md.h 를 src 안에 집어넣음
- src 하위 경로 외 다른경로에서 헤더파일 생성이 안되었음
- Maven 빌드환경에서 하다보니 src 하위 경로의 java 파일이 정상적으로 실행되지 않음  
<br><br>





